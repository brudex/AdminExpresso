@model ZenExpressoCore.Models.SupportTask
@{
    ViewBag.Title = @Model.description;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row" ng-app="app">
    <input type="hidden" value="@Model.id" id="__supportTaskId"/>
  
    <div class="col-md-12" data-ng-Controller="ExecuteTaskController as vm">
        <div class="block-web">
            <div class="header">
                <div class="actions">
                    <a class="minimize" href="#"><i class="fa fa-chevron-down"></i></a> <a class="close-down" href="#"><i class="fa fa-times"></i></a>
                </div>
                <h3 class="content-header">@Model.description</h3>
            </div>
            <div class="porlets-content">
            @if (Model.GetScriptParameters().Count > 0)
            {
                <div data-ng-init="vm.init()">
                </div> 
            }
            else
            {
                <div data-ng-init="vm.init(true)">
                </div>
            }
            @if (Model.GetScriptParameters().Any())
            {
                <form name="executeTaskForm" class="form-horizontal group-border-dashed" parsley-validate="" novalidate="" data-ng-submit="vm.executeSupportTask(executeTaskForm.$valid)">

                    @foreach (var scriptParam in Model.GetScriptParameters())
                    {
                        if (scriptParam.parameterType == "number")
                        {
                            <div class="form-group" data-ng-class="{'has-error': vm.formSubmitted && executeTaskForm.@scriptParam.parameterName.$invalid }">
                                <label class="col-sm-3 control-label">@scriptParam.parameterLabel</label>
                                <div class="col-sm-6">
                                    <input type="number" data-ng-model="vm.model.@scriptParam.parameterName" name="@scriptParam.parameterName" class="form-control parsley-validated" required="">
                                </div>
                            </div>
                        }
                        else if (scriptParam.parameterType == "regex")
                        {
                            <div class="form-group" data-ng-class="{'has-error': vm.formSubmitted && executeTaskForm.@scriptParam.parameterName.$invalid }">
                                <label class="col-sm-3 control-label">@scriptParam.parameterLabel</label>
                                <div class="col-sm-6">
                                    <input type="text" data-ng-model="vm.model.@scriptParam.parameterName" ng-pattern="/@scriptParam.parameterRegex/" name="@scriptParam.parameterName" class="form-control parsley-validated" required="">
                                </div>
                            </div>
                        }
                        else if (scriptParam.parameterType == "text")
                        {
                            <div class="form-group" data-ng-class="{'has-error': vm.formSubmitted && executeTaskForm.@scriptParam.parameterName.$invalid }">
                                <label class="col-sm-3 control-label">@scriptParam.parameterLabel</label>
                                <div class="col-sm-6">
                                    <input type="text" data-ng-model="vm.model.@scriptParam.parameterName" name="@scriptParam.parameterName" class="form-control parsley-validated" required="">
                                </div>
                            </div>
                        }
                        else if (scriptParam.parameterType == "date")
                        {
                            <div class="form-group" data-ng-class="{'has-error': vm.formSubmitted && executeTaskForm.@scriptParam.parameterName.$invalid }">
                                <label class="col-sm-3 control-label ">@scriptParam.parameterLabel</label>
                                <div class="col-sm-6">
                                    <input type="text" data-ng-model="vm.model.@scriptParam.parameterName" name="@scriptParam.parameterName" class="form-control " jquerydatepicker required="">
                                </div>
                            </div>
                        }
                        else if (scriptParam.parameterType == "dropdown")
                        {
                            <div class="form-group" data-ng-class="{'has-error': vm.formSubmitted && executeTaskForm.@scriptParam.parameterName.$invalid }">
                                <label class="col-sm-3 control-label">@scriptParam.parameterLabel</label>
                                <div class="col-sm-6">
                                    <select class="form-control" required data-ng-model="vm.model.@scriptParam.parameterName" name="@scriptParam.parameterName">
                                        @foreach (var selectOption in scriptParam.GetSelectOptions())
                                        {
                                            <option value="@selectOption">@selectOption</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        }

                    }

                    <div class="form-group">
                        <div class="col-sm-offset-3 col-sm-10">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div><!--/form-group-->
                </form>
            }
            <div style="overflow-x:scroll">
                <table class="display table table-bordered table-striped" id="dynamic-table"></table>
            </div>
</div><!--/porlets-content-->
        </div><!--/block-web-->
    </div><!--/col-md-12-->
</div>


