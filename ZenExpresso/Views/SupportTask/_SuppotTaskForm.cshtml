@model List<ZenExpressoCore.Models.DataSource>
<div class="block-web">
    <div class="header">
        <div class="actions">
            <a class="minimize" href="#"><i class="fa fa-chevron-down"></i></a> <a class="close-down" href="#"><i class="fa fa-times"></i></a>
        </div>
        <h3 class="content-header">@ViewBag.Title </h3>
    </div>
    <div class="porlets-content">
        <form name="addTaskForm" class="form-horizontal group-border-dashed" autocomplete="off" parsley-validate="" novalidate="" data-ng-submit="vm.submitSupportTask(addLogForm.$valid)">
            <input autocomplete="false" name="hidden" type="text" style="display:none;">
            <div class="form-group" data-ng-show="vm.errorMsg.length">
                <label class="col-sm-3 control-label"></label>
                <div class="col-sm-6">
                    <div class="alert alert-danger col-md-6">
                        <ul>
                            <li data-ng-repeat="item in vm.errorMsg">{{item}}</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!--/form-group-->
            <div class="form-group" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.taskName.$invalid }">
                <label class="col-sm-3 control-label">Task Name</label>
                <div class="col-sm-6">
                    <input type="text" data-ng-model="vm.model.taskName" name="taskName" class="form-control parsley-validated" required="">
                </div>
            </div><!--/form-group-->
            <div class="form-group" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.description.$invalid }">
                <label class="col-sm-3 control-label">Task Description</label>
                <div class="col-sm-6">
                    <input type="text" data-ng-model="vm.model.description" name="description" class="form-control parsley-validated" required="">
                </div>
            </div><!--/form-group-->
            <div class="form-group" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.taskType.$invalid }">
                <label class="col-sm-3 control-label">Type of Task</label>
                <div class="col-sm-6">
                    <select class="form-control" data-ng-model="vm.model.taskType" required="" name="taskType">
                        @foreach (var dataSource in Model)
                        {
                            <option value="@dataSource.dataSourceName">@dataSource.dataSourceLabel </option>
                        }
                    </select>
                </div>
            </div>
            <div class="form-group" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.taskResultType.$invalid }">
                <label class="col-sm-3 control-label">Task Result Type</label>
                <div class="col-sm-6">
                    <select class="form-control" data-ng-model="vm.model.taskResultType" required="" name="taskResultType">
                        <option value="tableresult">Table Result </option>
                        <option value="successCode">Success Code Result</option>
                        <option value="execJsResult">Execute Javascript on Result</option>
                    </select>
                </div>
            </div>
            <div class="form-group" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.topLevelMenu.$invalid }">
                <label class="col-sm-3 control-label">Top Level Menu</label>
                <div class="col-sm-6">
                    <select class="form-control" data-ng-model="vm.model.topLevelMenu" data-ng-options="item.menuName as item.menuName for item in vm.topMenus" required="" name="topLevelMenu">
                        <option value="">Select Parent Menu</option>
                    </select>
                </div>
            </div>
            <div class="form-group" data-ng-show="vm.model.taskResultType=='execJsResult'">
                <label class="col-sm-3 control-label"></label>
                <div class="col-sm-6">
                    <button class="btn btn-primary btn-md" data-toggle="modal" data-target="#jsModal">Write Javascript</button>
                </div>
            </div>
            <!--/form-group-->
            <div class="form-group">
                <label class="col-sm-3 control-label">Database Credentials</label>
                <div class="col-sm-2" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.dbusername.$invalid }">
                    <input type="text" autocomplete="off" data-ng-model="vm.model.dbusername" name="dbusername" class="form-control parsley-validated" required="" placeholder="DbUser">
                </div>
                <div class="col-sm-2" data-ng-class="{'has-error':vm.formSubmitted && addTaskForm.dbPass    .$invalid }">
                    <input type="password" autocomplete="off" data-ng-model="vm.model.dbPass" name="dbPass" class="form-control parsley-validated" required="" placeholder="DbPass">
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-sm btn-primary btn-block" data-ng-click="vm.testConnection()">Test Connection</button>
                </div>
            </div><!--/form-group-->
            <div class="form-group">
                <label class="col-sm-3 control-label"></label>
                <div class="col-sm-6">
                    <button class="btn btn-primary btn-md" data-toggle="modal" data-target="#sqlModal">Sql Script</button>
                </div>
            </div><!--/form-group-->
            <div class="form-group">
                <label class="col-sm-3 control-label"> Script</label>
                <div class="col-sm-6">
                    <div class="form-control" style="min-height: 100px; max-height: 200px;overflow-y: scroll">
                        <pre data-ng-show="vm.model.sqlScript"><code data-ng-bind="vm.model.sqlScript"></code>
                        </pre>
                    </div>
                </div>
            </div>
            <!--/form-group-->
            <div class="form-group">
                <label class="col-sm-3 control-label"></label>
                <div class="col-sm-6">
                    <label class="control-label">Parameter Placeholders</label>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="item in vm.model.parameters">
                                <td data-ng-bind="item.parameterName">Name</td>
                                <td data-ng-bind="item.parameterType">Type/td>
                                <td>
                                    <input type="text" value="" data-ng-model="item.parameterValue" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label"></label>
                <div class="col-sm-6">
                    <button class="btn btn-success btn-lg" data-ng-click="vm.submitSupportTask(addTaskForm.$valid)">Submit</button>
                </div>
            </div>

        </form>
    </div>
</div>

<div class="modal fade  " id="sqlModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Enter Sql Script</h4>
            </div>
            <div class="modal-body">
                <textarea data-ng-model="vm.model.sqlScript" name="sqlCode" cols="10" rows="15" class="form-control"></textarea>
                <br />
                <div class="row">
                    <div class="col-md-12">
                        <h5 class="row">Query Parameters</h5>
                        <div class="alert alert-danger col-md-6" data-ng-show="vm.errorParameter.length">
                            <ul>
                                <li data-ng-repeat="item in vm.errorParameter">{{item}}</li>
                            </ul>
                        </div>
                        <div class="row">
                            <div class="col-md-9 h6">
                                <div class="col-md-3">Parameter Label</div>
                                <div class="col-md-3">Parameter Name</div>
                                <div class="col-md-3">Parameter Type</div>
                                <div class="col-md-3">
                                    <span data-ng-show="vm.parameter.parameterType=='regex'"> Regex Value</span>
                                    <span data-ng-show="vm.parameter.parameterType=='dropdown'"> Drop down</span>
                                   
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-10">
                                <div class="col-md-3">
                                    <input type="text" value="" placeholder="Parameter Label" class="form-control input-sm" data-ng-model="vm.parameter.parameterLabel" />
                                </div>
                                <div class="col-md-2">
                                    <input type="text" value="" placeholder="Parameter Name" class="form-control input-sm" data-ng-model="vm.parameter.parameterName" />
                                </div>
                                <div class="col-md-3">
                                    <select type="text" value="" class="form-control input-sm" data-ng-model="vm.parameter.parameterType">
                                        <option value="">Select one..</option>
                                        <option value="text">Text</option>
                                        <option value="number">Numeric</option>
                                        <option value="date">Date</option>
                                        <option value="regex">Regex</option>
                                        <option value="dropdown">Dropdown</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <input type="text" data-ng-show="vm.parameter.parameterType=='regex'" value="" placeholder="Regular Expression Validator" class="form-control input-sm" data-ng-model="vm.parameter.parameterRegex" />
                                    <input type="text" data-ng-show="vm.parameter.parameterType=='dropdown'" value="" placeholder="Drop down options" class="form-control input-sm" data-ng-model="vm.parameter.optionsList" />
                                </div>

                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-primary btn-sm " data-ng-click="vm.addSqlParameter()">Add Parameter</button>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-md-10">
                                <br />
                                <table class="table table-sm table-responsive">
                                    <tbody>
                                    <tr data-ng-repeat="item in vm.model.parameters">
                                        <td><span data-ng-bind="item.parameterLabel"></span></td>
                                        <td><span data-ng-bind="item.parameterName"></span></td>
                                        <td><span data-ng-bind="item.parameterType"></span></td>
                                        <td>
                                            <span data-ng-show="item.parameterType=='regex'" data-ng-bind="item.parameterRegex"></span>
                                            <span data-ng-show="item.parameterType=='dropdown'" data-ng-bind="item.optionsList"></span>
                                        </td>
                                        <td><button class="btn btn-xs btn-danger" data-ng-click="vm.removeSqlParameter ($index)">Delete</button></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade  " id="jsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Enter Javascript</h4>
            </div>
            <div class="modal-body">
                <pre style="padding: 0"><code data-language="javascript">
    //Your code will be embedded in a function with the following arguemnents
    //result : result from Server
    //utils.alertSuccess , utils.alertError, utils.sweetAlert, utils.alertConfirm, utils.toastr, utils._
    //renderDataTable(objectArray) available as params
    function(result,utils,renderDataTable)
    {  //put your code in the box below
                      </code></pre>
                <textarea data-ng-model="vm.model.jsScript" name="sqlCode" cols="7" rows="15" class="form-control"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
